# プロジェクト要件

このドキュメントは、Discord読書カウンターBotの機能要件と技術要件を定義します。

## 1. 概要

このプロジェクトは、ユーザーがDiscordのスラッシュコマンドを通じて読書の進捗を記録・管理できるBotを開発することを目的とします。

Botのバックエンドはサーバーレス関数として動作し、データはGoogle Apps Script (GAS) のWeb APIを介してGoogleスプレッドシートに保存されます。

## 2. コアコンセプト

- **共有本棚:** 書籍は単一の共有本棚に登録され、Botが導入されているサーバーのメンバーで共有されます。
- **書籍情報の自動取得:** Google Books APIと連携し、ISBNやタイトルから書籍情報を自動で取得することで、ユーザーの入力負荷を軽減します。
- **進捗記録の柔軟性:** ページ数だけでなく、パーセント（%）での進捗記録にも対応し、電子書籍の読書体験をサポートします。

## 3. 機能要件

### 3.1. 書籍の登録

- **コマンド:** `/register`
- **説明:** 新しい本を共有本棚に登録します。
- **オプション:**
  - `query` (文字列, 必須): ISBN、または書籍のタイトル。
- **動作:**
  1. Botは指定されたクエリでGoogle Books APIを検索します。
  2. 候補が見つかった場合、著者、総ページ数、表紙画像などの情報をユーザーに提示し、登録の確認を求めます。
  3. ユーザーが承認すると、書籍が`Books`シートに保存されます。
  4. 登録しようとしたISBNが既に存在する場合、重複登録を防止し、その旨をユーザーに通知します。

### 3.2. 読書進捗の記録

- **コマンド:** `/record`
- **説明:** 読書の進捗を記録します。
- **オプション:**
  - `book` (文字列, 必須): 登録済みの本のタイトル（オートコンプリートで候補を表示）。
  - `page_count` (整数, オプション): この読書セッションで読んだページ数。
  - `progress_percent` (整数, オプション): 現在の読書進捗（%）。
- **動作:**
  - `page_count`が指定された場合、そのページ数を`ReadingLogs`に記録し、`ReadingStatus`を更新します。
  - `progress_percent`が指定された場合、現在の進捗との差分をページ数に換算して`ReadingLogs`に記録し、`ReadingStatus`を更新します。

### 3.3. 読書状況の確認

- **コマンド:** `/status`
- **説明:** 自分、または指定したユーザーが「今読んでいる本」の一覧と進捗を表示します。
- **オプション:**
  - `user` (ユーザー, オプション): 状況を見たいユーザー（デフォルトは自分自身）。

### 3.4. 読書統計の表示

- **コマンド:** `/stats`
- **説明:** 読書量や冊数の統計情報を表示します。
- **オプション:**
  - `period` (選択肢, オプション): `monthly` (月間), `total` (累計) などの集計期間（デフォルトは`monthly`）。
  - `user` (ユーザー, オプション): 統計を見たいユーザー（デフォルトは自分自身）。

## 4. 技術要件

### 4.1. Botバックエンド

- **言語:** Go
- **実行環境:** Google Cloud Functions (サーバーレス)
- **トリガー:** Discord Interaction Webhook (HTTP POST)
- **外部連携:** Google Books API

### 4.2. データストレージ & API

- **データベース:** Googleスプレッドシート
- **APIレイヤー:** Google Apps Script (ウェブアプリケーションとしてデプロイ)
- **スキーマ:** データ構造の詳細は [`database-schema.md`](./database-schema.md) を参照してください。

### 4.3. ソースコード管理

- **戦略:** モノレポ
- **リポジトリ:** 単一のGitリポジトリがGoとGASの両方のソースコードを管理します。
- **構造:** GoとGASのコードベースは、それぞれ別のディレクトリ (`go-bot/`, `gas-api/`) に分離されます。
